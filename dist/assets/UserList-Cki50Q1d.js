import{_ as E,r as p,c as f,d as r,f as e,w as t,k as D,j as H,b as o,o as b,D as G,g as S,t as h,s as N,e as x,q as J,u as P,a as Q,n as W}from"./index-Cp_zlRUQ.js";const X={class:"top-panel"},Y={class:"file-list"},Z={class:"avatar"},ee={style:{color:"#52f"}},te={style:{color:"#333"}},ae={key:0,class:"use use-notuse"},se={key:1,class:"notuse use-notuse"},le=["onClick"],oe=["onClick"],ne={__name:"UserList",setup(ue){P(),Q();const{proxy:u}=H(),g={loadDataList:"/admin/loadUserList",updateUserStatus:"/admin/updateUserStatus",updateUserSpace:"/admin/updateUserSpace"},z=[{label:"头像",prop:"avatar",width:60,scopedSlots:"avatar"},{label:"昵称",prop:"nickName"},{label:"邮箱",prop:"email"},{label:"空间使用",prop:"space",scopedSlots:"space"},{label:"加入时间",prop:"createTime"},{label:"最后登录时间",prop:"lastLoginTime"},{label:"状态",prop:"status",scopedSlots:"status",width:80},{label:"操作",prop:"op",width:200,scopedSlots:"op"}],d=p({}),_=p({}),I={extHeight:20},U=p(0),i=p({}),y=p(),c=p({show:!1,title:"修改空间大小",buttons:[{type:"primary",text:"确定",click:s=>{F()}}]}),R={changeSpace:[{required:!0,message:"请输入空间大小"},{validator:u.Verify.space,message:"请输入数字"}]},m=async()=>{let s={pageNo:_.value.pageNo||1,pageSize:_.value.pageSize||15};Object.assign(s,d.value);let a=await u.Request({url:g.loadDataList,params:s});a&&(U.value=+new Date,_.value=a)},L=s=>{u.Confirm(`你确定要${s.status==1?"启用":"禁用"} ${s.nickName} 吗`,async()=>{await u.Request({url:g.updateUserStatus,params:{userId:s.userId,status:s.status==0?1:0}})&&m()})},T=s=>{c.value.show=!0,W(()=>{y.value.resetFields(),i.value=Object.assign({},s)})},F=()=>{y.value.validate(async s=>{console.log(i.value),!(!s||!await u.Request({url:g.updateUserSpace,params:{userId:i.value.userId,changeSpace:i.value.changeSpace*1024*1024}}))&&(c.value.show=!1,u.Message.success("操作成功"),m())})};return(s,a)=>{const w=o("el-input"),v=o("el-form-item"),k=o("el-col"),V=o("el-option"),q=o("el-select"),M=o("el-button"),$=o("el-row"),C=o("el-form"),B=o("Avatar"),j=o("el-divider"),A=o("Table"),O=o("Dialog");return b(),f("div",null,[r("div",X,[e(C,{"label-width":"80px",onSubmit:a[2]||(a[2]=D(()=>{},["prevent"]))},{default:t(()=>[e($,null,{default:t(()=>[e(k,{span:8},{default:t(()=>[e(v,{label:"用户昵称"},{default:t(()=>[e(w,{clearable:"",placeholder:"支持模糊搜索",modelValue:d.value.nickNameFuzzy,"onUpdate:modelValue":a[0]||(a[0]=n=>d.value.nickNameFuzzy=n),modelModifiers:{trim:!0},onKeyup:G(m,["enter"])},null,8,["modelValue"])]),_:1})]),_:1}),e(k,{span:6},{default:t(()=>[e(v,{label:"状态"},{default:t(()=>[e(q,{clearable:"",placeholder:"请选择状态",modelValue:d.value.status,"onUpdate:modelValue":a[1]||(a[1]=n=>d.value.status=n)},{default:t(()=>[e(V,{value:0,label:"启用"}),e(V,{value:1,label:"禁用"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(k,{span:4},{default:t(()=>[e(M,{type:"primary",style:{"margin-left":"20px"},onClick:m},{default:t(()=>[S("查询")]),_:1})]),_:1})]),_:1})]),_:1})]),r("div",Y,[e(A,{ref:"dataTableRef",columns:z,dataSource:_.value,fetch:m,initFetch:!0,options:I},{avatar:t(({index:n,row:l})=>[r("div",Z,[e(B,{userId:l.userId,avatar:null,timestamp:U.value},null,8,["userId","timestamp"])])]),space:t(({index:n,row:l})=>[r("div",null,[r("span",ee,h(N(u).Utils.size2Str(l.useSpace)),1),S(" / "),r("span",te,h(N(u).Utils.size2Str(l.totalSpace)),1)])]),status:t(({index:n,row:l})=>[l.status==0?(b(),f("div",ae,"已启用")):x("",!0),l.status==1?(b(),f("div",se,"已禁用")):x("",!0)]),op:t(({index:n,row:l})=>[r("span",{class:"a-link",onClick:K=>T(l)},"分配空间 ",8,le),e(j,{direction:"vertical"}),l.isAdmin?x("",!0):(b(),f("span",{key:0,class:"a-link",onClick:K=>L(l),style:J(l.status==0?{color:"#f56c62"}:{color:"#529b2e"})},h(l.status==1?"启用":"禁用"),13,oe))]),_:1},8,["dataSource"])]),e(O,{show:c.value.show,title:c.value.title,buttons:c.value.buttons,width:"400px",showCancel:!1,onClose:a[5]||(a[5]=n=>c.value.show=!1)},{default:t(()=>[e(C,{model:i.value,rules:R,ref_key:"formDataRef",ref:y,onSubmit:a[4]||(a[4]=D(()=>{},["prevent"]))},{default:t(()=>[e(v,{label:"昵称"},{default:t(()=>[S(h(i.value.nickName),1)]),_:1}),e(v,{label:"添加空间大小",prop:"changeSpace"},{default:t(()=>[e(w,{clearable:"",placeholder:"请输入空间大小",modelValue:i.value.changeSpace,"onUpdate:modelValue":a[3]||(a[3]=n=>i.value.changeSpace=n),modelModifiers:{trim:!0}},{suffix:t(()=>[S("MB")]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title","buttons"])])}}},re=E(ne,[["__scopeId","data-v-a74765d2"]]);export{re as default};
