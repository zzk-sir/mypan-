import{_ as W,u as X,a as Y,r,b as p,o as s,c as n,d,f as v,w as c,E as U,e as o,g as C,i as N,F as Z,t as I,q as ee,v as le,j as te,x as se,y as ae}from"./index-B4Kzr3cv.js";const oe=F=>(se("data-v-fd583542"),F=F(),ae(),F),ne={class:"top"},ie={class:"top-op"},ce=oe(()=>d("span",{class:"iconfont icon-del"},null,-1)),de={class:"search-panel"},ue={key:0,class:"file-list"},re=["onMouseenter","onMouseleave"],fe=["onClick"],pe=["title"],ve={class:"opt"},_e=["onClick"],me={key:1,class:"transfer-status"},he={key:2,class:"transfer-status tranfer-fail"},ke={key:4,class:"edit-panel"},ye=["onClick"],ge=["onClick"],Ce={key:0},Ne={key:0},Fe={key:1},Ie={__name:"FileList",emits:["reload"],setup(F,{emit:E}){X(),Y();const{proxy:i}=te(),m={loadDataList:"/admin/loadFileList",delFile:"/admin/delFile",createDownLoadUrl:"/admin/createDownloadUrl",download:"/api/admin/download"},M=[{label:"文件名",prop:"fileName",scopedSlots:"fileName"},{label:"发布人",prop:"nickName"},{label:"修改时间",prop:"lastUpdateTime",width:200},{label:"大小",prop:"fileSize",scopedSlots:"fileSize",width:200},{label:"位置",prop:"delFlag",scopedSlots:"delFlag"}],u=r({}),D=r({extHeight:50,selectType:"checkBox"}),h=r(),k=r([]),S=r(!0),T=r({fileId:"0"}),z=r(),$=r(),L=()=>{S.value=!0,g(),_(),h.value=null},B=()=>{h.value=null,g(),_()},O=l=>{k.value=[],l.forEach(t=>{k.value.push(t.userId+"_"+t.fileId)})},q=l=>{const{curFolder:t}=l;console.log("nav",l),T.value=t,S.value=!0,g(),_()},y=l=>{if(l.folderType==1){z.value.openFolder(l);return}if(l.status!=2){i.Message.warning("文件正在转码中，暂时无法预览，刷新试试");return}$.value.showPreview(l,1)},w=l=>{u.value.list.forEach(t=>{t.showOp=!1}),l.showOp=!0},P=l=>{l.showOp=!1},g=()=>{u.value.pageNo=null},x=E,_=async()=>{console.log("加载文件数据");let l={pageNo:u.value.pageNo||1,pageSize:u.value.pageSize||15,fileNameFuzzy:h.value,filePid:T.value.fileId},t=await i.Request({url:m.loadDataList,params:l,showLoading:S.value});t&&(u.value=t)},K=l=>{i.Confirm(`你确定要删除【${l.fileName}】吗？在管理端删除文件将会永久删除，还请三思.`,async()=>{let t=await i.Request({url:m.delFile,params:{fileIdAndUserIds:l.userId+"_"+l.fileId}});t&&(i.Message.success(t),g(),_(),x("reload"))})},j=()=>{k.value.length!=0&&i.Confirm("你确定要删除这些文件吗? 在管理端删除文件将会永久删除，还请三思.",async()=>{let l=await i.Request({url:m.delFile,params:{fileIdAndUserIds:k.value.join(",")}});l&&(i.Message.success(l),g(),_(),x("reload"))})},A=async l=>{console.log(l);let t=await i.Request({url:m.createDownLoadUrl+"/"+l.userId+"/"+l.fileId});if(t)window.location.href=m.download+"/"+t;else return};return(l,t)=>{const b=p("el-button"),V=p("el-input"),H=p("Navigation"),R=p("Icon"),G=p("el-popover"),J=p("Table"),Q=p("Preview");return s(),n("div",ne,[d("div",ie,[v(b,{type:"danger",onClick:j,disabled:k.value.length==0},{default:c(()=>[ce,C(" 批量删除 ")]),_:1},8,["disabled"]),d("div",de,[v(V,{clearable:"",placeholder:"请输入文件名搜索",modelValue:h.value,"onUpdate:modelValue":t[0]||(t[0]=f=>h.value=f),modelModifiers:{trim:!0},onKeyup:U(L,["enter"])},{suffix:c(()=>[d("i",{class:"iconfont icon-search",onClick:L})]),_:1},8,["modelValue"])]),d("div",{class:"iconfont icon-refresh",onClick:B})]),v(H,{ref_key:"navigationRef",ref:z,onNavChange:q},null,512),u.value.list&&u.value.list.length>0?(s(),n("div",ue,[v(J,{ref:"dataTableRef",columns:M,dataSource:u.value,fetch:_,initFetch:!1,options:D.value,onRowSelected:O},{fileName:c(({index:f,row:e})=>[d("div",{class:"file-item",onMouseenter:a=>w(e),onMouseleave:a=>P(e)},[(e.fileType==3||e.fileType==1)&&e.status==2?(s(),N(R,{key:0,cover:e.fileCover,width:32,onClick:a=>y(e)},null,8,["cover","onClick"])):(s(),n(Z,{key:1},[e.folderType==0?(s(),N(R,{key:0,fileType:e.fileType,onClick:a=>y(e)},null,8,["fileType","onClick"])):o("",!0),e.folderType==1?(s(),N(R,{key:1,fileType:0,onClick:a=>y(e)},null,8,["onClick"])):o("",!0)],64)),C("    "),!e.fileId||e.status!=2?(s(),n("span",{key:2,onClick:a=>y(e)},I(e.fileName),9,fe)):o("",!0),e.showEdit?o("",!0):(s(),n("span",{key:3,class:"file-name",title:e.fileName},[e.fileId&&e.status==2?(s(),N(G,{key:0,placement:"left",width:20,trigger:"hover"},{reference:c(()=>[d("span",{onClick:a=>y(e)},I(e.fileName),9,_e)]),default:c(()=>[d("div",ve,[e.folderType==0?(s(),N(b,{key:0,class:"iconfont icon-download",onClick:a=>A(e)},{default:c(()=>[C(" 下载 ")]),_:2},1032,["onClick"])):o("",!0),v(b,{class:"iconfont icon-del",onClick:a=>K(e)},{default:c(()=>[C("删除")]),_:2},1032,["onClick"])])]),_:2},1024)):o("",!0),e.status==0?(s(),n("span",me,"转码中")):o("",!0),e.status==1?(s(),n("span",he,"转码失败")):o("",!0)],8,pe)),e.showEdit?(s(),n("div",ke,[v(V,{modelValue:e.fileNameReal,"onUpdate:modelValue":a=>e.fileNameReal=a,modelModifiers:{trim:!0},ref:"editNameRef",maxLength:190,type:"text",onKeyup:U(a=>l.saveNameEdit(f),["enter"])},{suffix:c(()=>[C(I(e.fileSuffix),1)]),_:2},1032,["modelValue","onUpdate:modelValue","onKeyup"]),d("span",{class:ee(["iconfont icon-right1",e.fileNameReal?"":"not-allow"]),onClick:a=>l.saveNameEdit(f)},null,10,ye),d("span",{class:"iconfont icon-error",onClick:a=>l.cancelNameEdit(f)},null,8,ge)])):o("",!0)],40,re)]),fileSize:c(({index:f,row:e})=>[e.fileSize?(s(),n("span",Ce,I(le(i).Utils.size2Str(e.fileSize)),1)):o("",!0)]),delFlag:c(({index:f,row:e})=>[e.delFlag==1?(s(),n("span",Ne," 回收站 ")):e.delFlag==2?(s(),n("span",Fe," 主目录 ")):o("",!0)]),_:1},8,["dataSource","options"])])):o("",!0),v(Q,{ref_key:"previewRef",ref:$},null,512)])}}},be=W(Ie,[["__scopeId","data-v-fd583542"]]);export{be as default};
