import{_ as ee,r as l,c as u,d as a,z as se,F as b,f,t as _,w as m,s as P,a as ae,b as h,I as oe,o as t,g as F,i as S,e as p,J as te,j as le,u as ne,v as ie,x as ce}from"./index-CWrL55Oj.js";const R=k=>(ie("data-v-8ec7a168"),k=k(),ce(),k),re=R(()=>a("span",{class:"iconfont icon-pan"},null,-1)),de=R(()=>a("span",{class:"name"},"My Pan",-1)),ue=[re,de],he={class:"share-body"},pe={key:0,class:"loading"},ve={class:"share-panel"},fe={class:"share-user-info"},_e={class:"avatar"},me={class:"share-info"},ge={class:"user-info"},ye={class:"nick-name"},Se={class:"share-time"},ke={class:"file-name"},Ie={class:"share-op-btn"},Ce=R(()=>a("span",{class:"iconfont icon-import"},null,-1)),we={class:"file-list"},Te=["onMouseenter","onMouseleave"],Ne=["onClick"],be=["title"],Fe={class:"opt"},Re=["onClick"],xe={key:0},ze={__name:"Share",setup(k){const{proxy:n}=le(),x=ae(),I=ne(),g={getShareLoginInfo:"/showShare/getShareLoginInfo",loadFileList:"/showShare/loadFileList",createDownloadUrl:"/showShare/createDownloadUrl",download:"/api/showShare/download",saveShare:"/showShare/saveShare"},L=[{label:"文件名",prop:"fileName",scopedSlots:"fileName"},{label:"修改时间",prop:"lastUpdateTime",width:200},{label:"大小",prop:"fileSize",scopedSlots:"fileSize",width:200}],v=l({}),O=l({extHeight:80,selectType:"checkBox"}),i=l([]),z=l({fileId:"0"}),D=l(),M=l(),c=x.params.shareId.split(" ")[0],r=l({}),C=l(),w=l([]),U=s=>{i.value=[],s.forEach(o=>{i.value.push(o.fileId)}),console.log(i.value,s)},j=s=>{v.value.list.forEach(o=>{o.showOp=!1}),s.showOp=!0},B=s=>{s.showOp=!1},q=s=>{const{curFolder:o}=s;z.value=o,A(),T()},y=s=>{if(s.folderType==1){D.value.openFolder(s);return}s.shareId=c,M.value.showPreview(s,2)},E=()=>{if(i.value.length!=0){if(!sessionStorage.getItem("authorization")){n.Message.success("请先登录"),I.replace(`/login?redirectUrl=${x.path}`);return}w.value=i.value,console.log(w.value,i.value),C.value.showFolderDialog()}},V=()=>{I.push("/")},A=()=>{v.value.pageNo=null};(async()=>{let s=await n.Request({url:g.getShareLoginInfo,params:{shareId:c}});if(!s){I.push(`/shareCheck/${c}`);return}r.value=s})();const T=async()=>{console.log("加载文件数据");let s={pageNo:v.value.pageNo||1,pageSize:v.value.pageSize||15,shareId:c,filePid:z.value.fileId},o=await n.Request({url:g.loadFileList,params:s});o&&(v.value=o)},H=async s=>{let o=await n.Request({url:g.createDownloadUrl+"/"+c+"/"+s.fileId});o||retrun,window.location.href=g.download+"/"+o},J=async s=>{await n.Request({url:g.saveShare,params:{shareId:c,shareFileIds:w.value.join(","),myFolderId:s}})&&(T(),n.Message.success("保存成功"),C.value.close())};return(s,o)=>{const G=h("Avatar"),$=h("el-button"),K=h("Navigation"),N=h("Icon"),Q=h("el-popover"),W=h("Table"),X=h("Preview"),Y=oe("loading");return t(),u(b,null,[a("div",{class:"share"},[a("div",{class:"header"},[a("div",{class:"header-content"},[a("div",{class:"logo",onClick:V},ue)])])]),a("div",he,[Object.keys(r.value).length==0?se((t(),u("div",pe,null,512)),[[Y,Object.keys(r.value).length==0]]):(t(),u(b,{key:1},[a("div",ve,[a("div",fe,[a("div",_e,[f(G,{userId:r.value.userId,avatar:null,width:50},null,8,["userId"])]),a("div",me,[a("div",ge,[a("span",ye,_(r.value.nickName),1),a("span",Se," 分享于: "+_(r.value.shareTime),1)]),a("div",ke,"分享文件: "+_(r.value.fileName),1)])]),a("div",Ie,[f($,{type:"primary",onClick:E,disabled:i.value.length==0},{default:m(()=>[Ce,F(" 保存到我的网盘")]),_:1},8,["disabled"])])]),f(K,{ref_key:"navigationRef",ref:D,onNavChange:q,shareId:P(c)},null,8,["shareId"]),a("div",we,[f(W,{ref:"dataTabelRef",columns:L,dataSource:v.value,fetch:T,initFetch:!1,options:O.value,onRowSelected:U},{fileName:m(({index:Z,row:e})=>[a("div",{class:"file-item",onMouseenter:d=>j(e),onMouseleave:d=>B(e)},[e.fileType==3||e.fileType==1?(t(),S(N,{key:0,cover:e.fileCover,width:32,onClick:d=>y(e)},null,8,["cover","onClick"])):(t(),u(b,{key:1},[e.folderType==0?(t(),S(N,{key:0,fileType:e.fileType,onClick:d=>y(e)},null,8,["fileType","onClick"])):p("",!0),e.folderType==1?(t(),S(N,{key:1,fileType:0,onClick:d=>y(e)},null,8,["onClick"])):p("",!0)],64)),F("    "),!e.fileId||e.folderType!=0?(t(),u("span",{key:2,class:"file-name-hover",onClick:d=>y(e)},_(e.fileName),9,Ne)):p("",!0),e.showEdit?p("",!0):(t(),u("span",{key:3,class:"file-name",title:e.fileName},[e.fileId&&e.folderType==0?(t(),S(Q,{key:0,placement:"left",width:20,trigger:"hover"},{reference:m(()=>[a("span",{onClick:d=>y(e)},_(e.fileName),9,Re)]),default:m(()=>[a("div",Fe,[e.folderType==0?(t(),S($,{key:0,class:"iconfont icon-download",onClick:d=>H(e)},{default:m(()=>[F(" 下载 ")]),_:2},1032,["onClick"])):p("",!0)])]),_:2},1024)):p("",!0)],8,be))],40,Te)]),fileSize:m(({index:Z,row:e})=>[e.fileSize?(t(),u("span",xe,_(P(n).Utils.size2Str(e.fileSize)),1)):p("",!0)]),_:1},8,["dataSource","options"])])],64)),f(te,{ref_key:"folderSelectRef",ref:C,onFolderSelect:J},null,512),f(X,{ref_key:"previewRef",ref:M},null,512)])],64)}}},$e=ee(ze,[["__scopeId","data-v-8ec7a168"]]);export{$e as default};
