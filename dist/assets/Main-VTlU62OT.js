import{r as c,b as v,o as u,c as _,f as a,w as o,k as Ne,g as d,t as R,F as X,i as E,e as y,j as ce,n as Y,_ as xe,C as Se,d as r,s as ie,D as ne,p as Te,v as Re,x as De,u as $e,a as Ve}from"./index-Wtykptcl.js";const Me={all:{accept:"*"},video:{accept:".mp4,.avi,.rmvb,.mkv,.mov"},music:{accept:".mp3,.wav,.wma,.mp2,.flac,.midi,.ra,.ape,.aac,.cda"},image:{accept:".jepg,.jpg,.png,.fig,.bmp,.dds,.psd,.pdt,.webp,.xmp,.svg,.tiff"},doc:{accept:".pdf,.doc,.docx,.xls,.xlsx,.txt"},others:{accept:"*"}},Ee={__name:"ShareFile",setup(j,{expose:G}){const{proxy:U}=ce(),L={shareFile:"/share/shareFile"},s=c({}),h=c(),k=c(document.location.origin+"/shareCheck/"),B=c(0),i=c({show:!1,title:"分享",buttons:[{type:"primary",text:"确定",click:g=>{z()}}]}),C=c({}),I=c(!0),D={validType:[{required:!0,message:"请选择有效期"}],codeType:[{required:!0,message:"请选择提取码类型"}],code:[{required:!0,message:"请选择提取码类型"},{validator:U.Verify.shareCode,message:"请输入提取码"},{min:5,max:5,message:"提取码5位"}]},F=g=>{B.value=0,i.value.show=!0,I.value=!0,C.value={},Y(()=>{h.value.resetFields(),s.value=Object.assign({},g)})},N=()=>{i.value.show=!1};G({show:F});const z=async()=>{if(Object.keys(C.value).length>0){i.value.show=!1;return}h.value.validate(async g=>{if(!g)return;let f={};Object.assign(f,s.value);let m=await U.Request({url:L.shareFile,params:f});m&&(B.value=1,C.value=m,i.value.buttons[0].text="关闭",I.value=!1)})},x=async()=>{await paoxy.toClipboard(`${k.value}${C.value.shareId} 提取码：${C.value.code}`).then(g=>{U.Message.success("复制成功")}).catch(g=>{U.Message.error(`复制失败：${g}`)})};return(g,f)=>{const m=v("el-form-item"),b=v("el-radio"),K=v("el-radio-group"),H=v("el-input"),J=v("el-button"),Q=v("el-form"),W=v("Dialog");return u(),_("div",null,[a(W,{show:i.value.show,title:i.value.title,buttons:i.value.buttons,onClose:N,width:"400px",showCancel:I.value,onShow:f[4]||(f[4]=S=>i.value.show=!1)},{default:o(()=>[a(Q,{model:s.value,rules:D,ref_key:"formDataRef",ref:h,"label-width":"80px",onSubmit:f[3]||(f[3]=Ne(()=>{},["prevent"]))},{default:o(()=>[a(m,{label:"分享文件",prop:""},{default:o(()=>[d(R(s.value.fileName),1)]),_:1}),B.value==0?(u(),_(X,{key:0},[a(m,{label:"有效期",prop:"validType"},{default:o(()=>[a(K,{modelValue:s.value.validType,"onUpdate:modelValue":f[0]||(f[0]=S=>s.value.validType=S)},{default:o(()=>[a(b,{value:0},{default:o(()=>[d("1天")]),_:1}),a(b,{value:1},{default:o(()=>[d("7天")]),_:1}),a(b,{value:2},{default:o(()=>[d("30天")]),_:1}),a(b,{value:3},{default:o(()=>[d("永久有效")]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(m,{label:"提取码",prop:"codeType"},{default:o(()=>[a(K,{modelValue:s.value.codeType,"onUpdate:modelValue":f[1]||(f[1]=S=>s.value.codeType=S)},{default:o(()=>[a(b,{value:0},{default:o(()=>[d("自定义")]),_:1}),a(b,{value:1},{default:o(()=>[d("系统生成")]),_:1})]),_:1},8,["modelValue"])]),_:1}),s.value.codeType==0?(u(),E(m,{key:0,label:"code",prop:"code"},{default:o(()=>[a(H,{clearable:"",placeholder:"请输入5位提取码",modelValue:s.value.code,"onUpdate:modelValue":f[2]||(f[2]=S=>s.value.code=S),maxLength:"5",style:{width:"130px"}},null,8,["modelValue"])]),_:1})):y("",!0)],64)):(u(),_(X,{key:1},[a(m,{label:"分享链接"},{default:o(()=>[d(R(k.value)+R(C.value.shareId),1)]),_:1}),a(m,{label:"提取码"},{default:o(()=>[d(R(C.value.code),1)]),_:1}),a(m,null,{default:o(()=>[a(J,{type:"primary",onClick:x},{default:o(()=>[d("复制链接")]),_:1})]),_:1})],64))]),_:1},8,["model"])]),_:1},8,["show","title","buttons","showCancel"])])}}},q=j=>(Re("data-v-8607bf96"),j=j(),De(),j),qe={class:"top"},Ue={class:"top-op"},ze={class:"btn"},Pe=q(()=>r("span",{class:"iconfont icon-upload"},null,-1)),Oe=q(()=>r("span",{class:"iconfont icon-folder-add"},null,-1)),je=q(()=>r("span",{class:"iconfont icon-del"},null,-1)),Le=q(()=>r("span",{class:"iconfont icon-del"},null,-1)),Be={class:"search-panel"},Ke={key:0,class:"file-list"},Ae=["onMouseenter","onMouseleave"],He=["onClick"],Ge=["title"],Je={class:"opt"},Qe=["onClick"],We={key:1,class:"transfer-status"},Xe={key:2,class:"transfer-status tranfer-fail"},Ye={key:4,class:"edit-panel"},Ze=["onClick"],el=["onClick"],ll={key:0},tl={key:1,class:"no-data"},al={class:"no-data-inner"},ol=q(()=>r("div",{class:"tips"},"当前目录为空，上传你的第一个文件吧",-1)),sl={class:"op-list"},il={class:"op-item"},nl=q(()=>r("div",null,"上传文件",-1)),cl=q(()=>r("div",null,"新建目录",-1)),ul={__name:"Main",emits:["addFile"],setup(j,{expose:G,emit:U}){$e();const L=Ve(),{proxy:s}=ce(),h={loadDataList:"/file/loadDataList",rename:"/file/rename",newFolder:"/file/newFolder",getFolderInfo:"/file/getFolderInfo",delFile:"/file/delFile",changeFileFolder:"/file/changeFileFolder",createDownloadUrl:"/file/createDownloadUrl",download:"/api/file/download"},k=c({fileId:"0"}),B=[{label:"文件名",prop:"fileName",scopedSlots:"fileName"},{label:"修改时间",prop:"lastUpdateTime",width:200},{label:"大小",prop:"fileSize",scopedSlots:"fileSize",width:200}],i=c({}),C=c({extHeight:50,selectType:"checkBox"}),I=c(),D=c(),F=c([]),N=c(),z=c(),x=c(!1),g=c(),f=c(),m=c(!0),b=c(),K=c();c(),c(!1);const H=Se(()=>{const e=Me[I.value];return e?e.accept:"*"}),J=e=>{F.value=[],e.forEach(l=>{F.value.push(l.fileId)})},Q=()=>{z.value={};let e=i.value.list.filter(l=>l.folderType==1&&F.value.includes(l.fileId)).map(l=>l.fileId);N.value.excludeSelectFolder(e),N.value.showFolderDialog(k.value.fileId)},W=e=>{z.value=e,e.fileType==1&&N.value.excludeSelectFolder([e]),N.value.showFolderDialog(k.value.fileId)},S=e=>{i.value.list.forEach(l=>{l.showOp=!1}),e.showOp=!0},ue=e=>{e.showOp=!1},Z=()=>{if(x.value)return;i.value.list.forEach(l=>{l.showEdit=!1}),x.value=!0;let e="0";if(L.query.path){let l=L.query.path.split("/");e=l[l.length-1]}i.value.list.unshift({showEdit:!0,fileType:0,fileId:"",filePid:e}),Y(()=>{var l;(l=g.value)==null||l.focus()})},de=e=>{const l=i.value.list[e];l.fileId?l.showEdit=!1:i.value.list.splice(e,1),x.value=!1},re=e=>{i.value.list[0].fileId==""&&(i.value.list.splice(0,1),e=e-1),i.value.list.forEach(n=>{n.showEdit=!1});let l=i.value.list[e];l.showEdit=!0,l.folderType==0?(l.fileNameReal=l.fileName.substring(0,l.fileName.lastIndexOf(".")),l.fileSuffix=l.fileName.substring(l.fileName.lastIndexOf("."))):(l.fileNameReal=l.fileName,l.fileSuffix=""),x.value=!0,Y(()=>{g.value.focus()})},ee=e=>{oe("addFile",{file:e.file,filePid:k.value.fileId,addFileCallback:w})},le=(e,l)=>{oe("addFile",{file:e,filePid:l||k.value.fileId,addFileCallback:w})},fe=e=>{console.log(e),te(e,k.value.fileId),T(),w()},te=async(e,l)=>{if(console.log(123,e),e.isDirectory){let n=await ke(l,e.name);if(!n)return;e.createReader().readEntries(V=>{for(let P of V)te(P,n.fileId)})}else e.file(n=>{n.uid=s.Utils.fileUid(),le(n,l)})},A=e=>{if(e.folderType==1){f.value.openFolder(e);return}if(e.status!=2){s.Message.warning("文件正在转码中，暂时无法预览，刷新试试");return}b.value.showPreview(e,0)},pe=e=>{const{categoryId:l,curFolder:n}=e;k.value=n,I.value=l,T(),w()},ve=()=>{m.value=!1,T(),w()},ae=()=>{m.value=!0,T(),w(),D.value=null},me=()=>{D.value=null,T(),w()},_e=e=>{K.value.show(e)},T=()=>{i.value.pageNo=null},oe=U;G({reload:ve,dropFile:le,dropFolder:fe});const w=async()=>{let e={pageNo:i.value.pageNo||1,pageSize:i.value.pageSize||15,fileNameFuzzy:D.value,filePid:k.value.fileId,category:I.value};e.category!=="all"&&delete e.filePid;let l=await s.Request({url:h.loadDataList,params:e,showLoading:m.value});l&&(i.value=l)},he=e=>{s.Confirm(`你确定要删除【${e.fileName}】吗？删除的文件可在10天内通过回收站还原.`,async()=>{let l=await s.Request({url:h.delFile,params:{fileIds:e.fileId}});l&&(s.Message.success(l),T(),w())})},ye=()=>{F.value.length!=0&&s.Confirm("你确定要删除这些文件吗? 删除的文件可在10天内通过回收站还原.",async()=>{let e=await s.Request({url:h.delFile,params:{fileIds:F.value.join(",")}});e&&(s.Message.success(e),T(),w())})},ge=async e=>{if(k.value.fileId==e){s.Message.warning("文件正在当前目录无需移动");return}let l=[];z.value.fileId?l.push(z.value.fileId):l=l.concat(F.value),await s.Request({url:h.changeFileFolder,params:{fileIds:l.join(","),filePid:e}})&&(N.value.close(),T(),w())},ke=async(e,l)=>{if(l==""||/[\\/\*\?\:]/.test(l)){s.Message.warning("文件名不能为空且不能含有/*?:");return}let n=await s.Request({url:h.newFolder,params:{filePid:e,fileName:l}});if(n)return x.value=!1,n},se=async e=>{console.log(i.value.list,e);const{fileId:l,filePid:n,fileNameReal:$}=i.value.list[e];if($==""||/[\\/\*\?\:]/.test($)){s.Message.warning("文件名不能为空且不能含有/*?:");return}let V=h.rename;l==""&&(V=h.newFolder);let P=await s.Request({url:V,params:{fileId:l,filePid:n,fileName:$}});P&&(i.value.list[e]=P,x.value=!1)},we=async e=>{let l=await s.Request({url:h.createDownloadUrl+"/"+e});if(l)window.location.href=h.download+"/"+l;else return};return(e,l)=>{const n=v("el-button"),$=v("el-upload"),V=v("el-input"),P=v("Navigation"),O=v("Icon"),Fe=v("el-popover"),Ce=v("Table"),be=v("FolderSelect"),Ie=v("Preview");return u(),_("div",qe,[r("div",Ue,[r("div",ze,[a($,{"show-file-list":!1,"with-credentials":!0,multiple:!0,"http-request":ee,accept:H.value},{default:o(()=>[a(n,{type:"primary"},{default:o(()=>[Pe,d(" 上传 ")]),_:1})]),_:1},8,["accept"])]),ie(L).params.category=="all"?(u(),E(n,{key:0,type:"success",onClick:Z},{default:o(()=>[Oe,d(" 新建文件夹 ")]),_:1})):y("",!0),a(n,{type:"danger",onClick:ye,disabled:F.value.length==0},{default:o(()=>[je,d(" 批量删除 ")]),_:1},8,["disabled"]),a(n,{type:"warning",onClick:Q,disabled:F.value.length==0},{default:o(()=>[Le,d(" 批量移动 ")]),_:1},8,["disabled"]),r("div",Be,[a(V,{clearable:"",placeholder:"请输入文件名搜索",modelValue:D.value,"onUpdate:modelValue":l[0]||(l[0]=M=>D.value=M),modelModifiers:{trim:!0},onKeyup:ne(ae,["enter"])},{suffix:o(()=>[r("i",{class:"iconfont icon-search",onClick:ae})]),_:1},8,["modelValue"])]),r("div",{class:"iconfont icon-refresh",onClick:me})]),a(P,{ref_key:"navigationRef",ref:f,onNavChange:pe},null,512),i.value.list&&i.value.list.length>0?(u(),_("div",Ke,[a(Ce,{ref:"dataTableRef",columns:B,dataSource:i.value,fetch:w,initFetch:!1,options:C.value,onRowSelected:J},{fileName:o(({index:M,row:t})=>[r("div",{class:"file-item",onMouseenter:p=>S(t),onMouseleave:p=>ue(t)},[(t.fileType==3||t.fileType==1)&&t.status==2?(u(),E(O,{key:0,cover:t.fileCover,width:32,onClick:p=>A(t)},null,8,["cover","onClick"])):(u(),_(X,{key:1},[t.folderType==0?(u(),E(O,{key:0,fileType:t.fileType,onClick:p=>A(t)},null,8,["fileType","onClick"])):y("",!0),t.folderType==1?(u(),E(O,{key:1,fileType:0,onClick:p=>A(t)},null,8,["onClick"])):y("",!0)],64)),d("    "),!t.fileId||t.status!=2?(u(),_("span",{key:2,onClick:p=>A(t)},R(t.fileName),9,He)):y("",!0),t.showEdit?y("",!0):(u(),_("span",{key:3,class:"file-name",title:t.fileName},[t.fileId&&t.status==2?(u(),E(Fe,{key:0,placement:"left",width:20,trigger:"hover"},{reference:o(()=>[r("span",{onClick:p=>A(t)},R(t.fileName),9,Qe)]),default:o(()=>[r("div",Je,[a(n,{class:"iconfont icon-share",onClick:p=>_e(t)},{default:o(()=>[d(" 分享 ")]),_:2},1032,["onClick"]),t.folderType==0?(u(),E(n,{key:0,class:"iconfont icon-download",onClick:p=>we(t.fileId)},{default:o(()=>[d(" 下载 ")]),_:2},1032,["onClick"])):y("",!0),a(n,{class:"iconfont icon-del",onClick:p=>he(t)},{default:o(()=>[d("删除")]),_:2},1032,["onClick"]),a(n,{class:"iconfont icon-edit",onClick:p=>re(M)},{default:o(()=>[d(" 重命名 ")]),_:2},1032,["onClick"]),a(n,{class:"iconfont icon-move",onClick:p=>W(t)},{default:o(()=>[d("移动")]),_:2},1032,["onClick"])])]),_:2},1024)):y("",!0),t.status==0?(u(),_("span",We,"转码中")):y("",!0),t.status==1?(u(),_("span",Xe,"转码失败")):y("",!0)],8,Ge)),t.showEdit?(u(),_("div",Ye,[a(V,{modelValue:t.fileNameReal,"onUpdate:modelValue":p=>t.fileNameReal=p,modelModifiers:{trim:!0},ref_key:"editNameRef",ref:g,maxlength:190,type:"text",onKeyup:ne(p=>se(M),["enter"])},{suffix:o(()=>[d(R(t.fileSuffix),1)]),_:2},1032,["modelValue","onUpdate:modelValue","onKeyup"]),r("span",{class:Te(["iconfont icon-right1",t.fileNameReal?"":"not-allow"]),onClick:p=>se(M)},null,10,Ze),r("span",{class:"iconfont icon-error",onClick:p=>de(M)},null,8,el)])):y("",!0)],40,Ae)]),fileSize:o(({index:M,row:t})=>[t.fileSize?(u(),_("span",ll,R(ie(s).Utils.size2Str(t.fileSize)),1)):y("",!0)]),_:1},8,["dataSource","options"])])):(u(),_("div",tl,[r("div",al,[a(O,{iconName:"no_data",width:120,fit:"fill"}),ol,r("div",sl,[a($,{"show-file-list":!1,"with-credentials":!0,multiple:!0,"http-request":ee,accept:H.value},{default:o(()=>[r("div",il,[a(O,{iconName:"file",width:60}),nl])]),_:1},8,["accept"]),I.value=="all"?(u(),_("div",{key:0,class:"op-item",onClick:Z},[a(O,{iconName:"folder",width:60}),cl])):y("",!0)])])])),a(be,{ref_key:"folderSelectRef",ref:N,onFolderSelect:ge},null,512),a(Ie,{ref_key:"previewRef",ref:b},null,512),a(Ee,{ref_key:"shareRef",ref:K},null,512)])}}},rl=xe(ul,[["__scopeId","data-v-8607bf96"]]);export{rl as default};
